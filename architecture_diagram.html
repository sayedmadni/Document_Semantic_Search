<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Admissions Search - Architecture Diagram</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        .subtitle {
            text-align: center;
            color: #6c757d;
            margin-bottom: 30px;
            font-style: italic;
        }
        .architecture-flow {
            margin: 20px 0;
        }
        .flow-step {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #dee2e6;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .flow-step:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .flow-step h3 {
            margin-top: 0;
            color: #495057;
            font-size: 1.4rem;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }
        .step-content p {
            margin: 10px 0;
            line-height: 1.6;
            color: #6c757d;
        }
        .step-content strong {
            color: #495057;
        }
        .flow-arrow {
            text-align: center;
            font-size: 2.5rem;
            color: #007bff;
            margin: 15px 0;
            font-weight: bold;
        }
        .description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #007bff;
        }
        .component-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .component {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .component h3 {
            color: #495057;
            margin-top: 0;
        }
        .component ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        .component li {
            margin: 5px 0;
        }
        .pipeline-section {
            background: #e3f2fd;
            border-left: 5px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .pipeline-section h4 {
            margin-top: 0;
            color: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç College Admissions Search - System Architecture</h1>
        <p class="subtitle">Complete RAG Pipeline: Document Processing ‚Üí Recontextualization ‚Üí Embedding ‚Üí Search</p>
        
        <div class="architecture-flow">
            <!-- DATA INGESTION PHASE -->
            <div class="pipeline-section">
                <h4>üì• PHASE 1: DATA INGESTION & INITIAL PROCESSING</h4>
            </div>

            <div class="flow-step">
                <h3>üìö Document Source</h3>
                <div class="step-content">
                    <p><strong>Education Corpus</strong> - PDF documents from `/home/anuragd/labshare/corpus/education`</p>
                    <p><strong>Batch Processing</strong> - Processes first 10-25 PDF files (configurable)</p>
                    <p><strong>Error Handling</strong> - Skips invalid/corrupted files automatically</p>
                    <p><strong>File Types</strong> - PDF format educational documents</p>
                </div>
            </div>

            <div class="flow-arrow">‚Üì</div>

            <div class="flow-step">
                <h3>üìÑ Document Conversion & Initial Chunking</h3>
                <div class="step-content">
                    <p><strong>Module</strong> - save_patents_mongodb.py (chunk_pdf function)</p>
                    <p><strong>Converter</strong> - Docling DocumentConverter (PDF ‚Üí Document structure)</p>
                    <p><strong>Chunker</strong> - Docling HybridChunker (hybrid text/structure chunking)</p>
                    <p><strong>Chunk Types</strong> - Separates text chunks from non-text chunks (tables, images)</p>
                    <p><strong>Metadata</strong> - Includes filename, source document, chunk type, timestamp</p>
                </div>
            </div>

            <div class="flow-arrow">‚Üì</div>

            <div class="flow-step">
                <h3>üóÑÔ∏è MongoDB Storage (Initial Chunks)</h3>
                <div class="step-content">
                    <p><strong>Database</strong> - doc_college_db</p>
                    <p><strong>Collection</strong> - text_chunks</p>
                    <p><strong>Storage</strong> - Original document chunks with metadata</p>
                    <p><strong>Format</strong> - JSON documents with chunk_id, text, source_url, filename</p>
                </div>
            </div>

            <!-- RECONTEXTUALIZATION PHASE -->
            <div class="pipeline-section">
                <h4>üîÑ PHASE 2: RECONTEXTUALIZATION PIPELINE</h4>
            </div>

            <div class="flow-arrow">‚Üì</div>

            <div class="flow-step">
                <h3>üîç Semantic Chunking</h3>
                <div class="step-content">
                    <p><strong>Module</strong> - recontext_chunking.py (create_semantic_chunks)</p>
                    <p><strong>Library</strong> - Chonkie SemanticChunker</p>
                    <p><strong>Input</strong> - Parent text chunks from MongoDB text_chunks collection</p>
                    <p><strong>Output</strong> - Meaning-coherent semantic spans (not fixed-size chunks)</p>
                    <p><strong>Artifacts</strong> - Semantic chunks saved to semantic_chunks.jsonl</p>
                </div>
            </div>

            <div class="flow-arrow">‚Üì</div>

            <div class="flow-step">
                <h3>üß† Contextual Chunking (LLM Enhancement)</h3>
                <div class="step-content">
                    <p><strong>Module</strong> - recontext_chunking.py (create_contextual_chunks)</p>
                    <p><strong>LLM Service</strong> - Ollama (OpenAI-compatible endpoint)</p>
                    <p><strong>Model</strong> - gpt-oss:20b</p>
                    <p><strong>Process</strong> - Adds minimal parent context to make chunks self-standing</p>
                    <p><strong>Prompt Strategy</strong> - Enriches semantic chunks with necessary context from parent</p>
                    <p><strong>Output</strong> - Recontextualized chunks saved to contextual_chunks.jsonl</p>
                </div>
            </div>

            <div class="flow-arrow">‚Üì</div>

            <div class="flow-step">
                <h3>üíæ MongoDB Storage (Recontextualized Chunks)</h3>
                <div class="step-content">
                    <p><strong>Module</strong> - recontext_chunking.py (load_recontextualized_chunks_in_db)</p>
                    <p><strong>Database</strong> - doc_college_db</p>
                    <p><strong>Collection</strong> - recontextualized_chunks</p>
                    <p><strong>Content</strong> - Contextual chunk text, semantic chunk ID, parent ID, metadata</p>
                </div>
            </div>

            <!-- EMBEDDING PHASE -->
            <div class="pipeline-section">
                <h4>üî¢ PHASE 3: EMBEDDING & VECTOR STORAGE</h4>
            </div>

            <div class="flow-arrow">‚Üì</div>

            <div class="flow-step">
                <h3>üî¢ Embedding Generation</h3>
                <div class="step-content">
                    <p><strong>Module</strong> - Embedding_Storing.py (embed_chunks)</p>
                    <p><strong>Source</strong> - Loads from MongoDB recontextualized_chunks collection</p>
                    <p><strong>Model</strong> - SentenceTransformer (multi-qa-mpnet-base-cos-v1)</p>
                    <p><strong>Vector Size</strong> - 768-dimensional embeddings</p>
                    <p><strong>Device</strong> - Automatic CUDA/CPU detection (GPU-accelerated if available)</p>
                </div>
            </div>

            <div class="flow-arrow">‚Üì</div>

            <div class="flow-step">
                <h3>üóÑÔ∏è Qdrant Vector Database</h3>
                <div class="step-content">
                    <p><strong>Module</strong> - Embedding_Storing.py (upsert_chunks_to_vecdb)</p>
                    <p><strong>Service</strong> - Qdrant Vector DB (localhost:6333)</p>
                    <p><strong>Collection</strong> - college_pathway_search</p>
                    <p><strong>Distance Metric</strong> - Cosine similarity</p>
                    <p><strong>Storage Format</strong> - Vector embeddings with payload (text, type, chunk_idx)</p>
                    <p><strong>Batch Processing</strong> - Upserts in batches of 50 points for efficiency</p>
                </div>
            </div>

            <!-- SEARCH & RETRIEVAL PHASE -->
            <div class="pipeline-section">
                <h4>üîé PHASE 4: SEARCH & RETRIEVAL</h4>
            </div>

            <div class="flow-arrow">‚Üì</div>

            <div class="flow-step">
                <h3>üñ•Ô∏è User Interface Layer</h3>
                <div class="step-content">
                    <p><strong>Framework</strong> - Streamlit Web App (Semantic_Search.py)</p>
                    <p><strong>Interface</strong> - Interactive web interface for college admission queries</p>
                    <p><strong>Features</strong> - Text area input, expandable results, AI analysis display</p>
                    <p><strong>Navigation</strong> - Search page and Architecture diagram viewer</p>
                </div>
            </div>

            <div class="flow-arrow">‚Üì</div>

            <div class="flow-step">
                <h3>üõ°Ô∏è Query Processing & Validation</h3>
                <div class="step-content">
                    <p><strong>Module</strong> - Semantic_Search.py (validate_input)</p>
                    <p><strong>Query Guardrails</strong> - Input validation and safety checks</p>
                    <p><strong>Toxicity Detection</strong> - Content moderation using detoxify (optional)</p>
                    <p><strong>Basic Rules</strong> - Length limits, profanity filtering, input sanitization</p>
                    <p><strong>Prompt Paraphrase</strong> - Query enhancement capability (currently commented)</p>
                </div>
            </div>

            <div class="flow-arrow">‚Üì</div>

            <div class="flow-step">
                <h3>üîç Vector Search</h3>
                <div class="step-content">
                    <p><strong>Module</strong> - Retreiving_Data_Qdrant.py (search_qdrant)</p>
                    <p><strong>Query Embedding</strong> - SentenceTransformer (multi-qa-mpnet-base-cos-v1)</p>
                    <p><strong>Vector Similarity</strong> - Cosine distance scoring in Qdrant</p>
                    <p><strong>Top-K Results</strong> - Returns top 3 most relevant chunks</p>
                    <p><strong>Result Format</strong> - Chunk text with metadata (source, chunk index)</p>
                </div>
            </div>

            <div class="flow-arrow">‚Üì</div>

            <div class="flow-step">
                <h3>ü§ñ AI Analysis & Response Generation</h3>
                <div class="step-content">
                    <p><strong>Module</strong> - Inference_Server_Model.py</p>
                    <p><strong>LLM Service</strong> - Ollama inference server</p>
                    <p><strong>Model</strong> - llama3.1 (local model)</p>
                    <p><strong>Context Assembly</strong> - Search results + user query</p>
                    <p><strong>Output</strong> - Comprehensive AI-generated answers with citations</p>
                </div>
            </div>

            <!-- TECHNICAL SPECIFICATIONS -->
            <div class="pipeline-section" style="margin-top: 40px;">
                <h4>‚öôÔ∏è TECHNICAL SPECIFICATIONS</h4>
            </div>

            <div class="component-list">
                <div class="component">
                    <h3>üì¶ Key Libraries</h3>
                    <ul>
                        <li>Docling - PDF conversion</li>
                        <li>Chonkie - Semantic chunking</li>
                        <li>SentenceTransformers - Embeddings</li>
                        <li>Qdrant - Vector database</li>
                        <li>PyMongo - MongoDB operations</li>
                        <li>Streamlit - Web interface</li>
                        <li>Ollama - LLM inference</li>
                    </ul>
                </div>
                <div class="component">
                    <h3>üóÑÔ∏è Data Stores</h3>
                    <ul>
                        <li>MongoDB - doc_college_db</li>
                        <li>Collection: text_chunks</li>
                        <li>Collection: recontextualized_chunks</li>
                        <li>Qdrant - college_pathway_search</li>
                    </ul>
                </div>
                <div class="component">
                    <h3>‚ö° Performance</h3>
                    <ul>
                        <li>GPU Acceleration - CUDA support</li>
                        <li>Batch Processing - 50 points per batch</li>
                        <li>Error Recovery - Skips invalid files</li>
                        <li>Parallel Processing - Optimized I/O</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>
</html>